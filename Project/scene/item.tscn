[gd_scene load_steps=6 format=2]

[ext_resource path="res://textures/items/flushsit.png" type="Texture" id=1]

[sub_resource type="GDScript" id=2]
resource_local_to_scene = true
script/source = "extends Area2D

export(Dictionary) var metadata = {
	\"type\": \"item\",
	\"denom\": \"flush_sit\",
	\"name\": \"pussyfart\",
	\"desc\": \"pussy shit\",
	\"spritepath\": \"textures/items/flushsit.png\",
	\"direction\": null,
	\"colliding\": null,
	\"sell\": 100,
	\"placing\": false,
	\"justplaced\": false
}
	
var innercollision = false

func fix_placing(direction):
	match direction:
		\"down\":
			position.y -= 1
			return
		\"up\":
			position.y += 1
			return
		\"left\":
			position.x += 1
			return
		\"right\":
			position.x -= 1
			return
		null:
			position = position

func _ready():
	$Sprite.texture = get_tree().current_scene.load_texture(get_meta(\"metadata\").spritepath)
	$Sprite.scale = Vector2(32/$Sprite.texture.get_size().x, 32/$Sprite.texture.get_size().y)
	$Sprite.texture.set_flags(0)

func _process(_delta):
	if get_meta(\"metadata\").placing == false:
		var conveyor = false
		var childcheck = $InnerCollision.get_overlapping_areas().duplicate(true)
		for area in childcheck:
			if area.has_meta(\"metadata\") && area.get_meta(\"metadata\").placing == false:
				if area.get_meta(\"metadata\").type == \"conveyor\" or area.get_meta(\"metadata\").type == \"splitter\" or area.get_meta(\"metadata\").type == \"trisplitter\" or area.get_meta(\"metadata\").type == \"producer\" or area.get_meta(\"metadata\").type == \"converter\":
					childcheck.append(area)
					conveyor = true
					break
		childcheck.erase(self)
		if get_overlapping_areas().empty() || conveyor == false || childcheck.empty():
			var stuff = get_meta(\"metadata\")
			stuff.direction = null
			set_meta(\"metadata\", stuff.duplicate(true))
			return
		if has_meta(\"metadata\") && conveyor == true:
			match get_meta(\"metadata\").direction:
				\"down\":
					position.y += 1
					return
				\"up\":
					position.y -= 1
					return
				\"left\":
					position.x -= 1
					return
				\"right\":
					position.x += 1
					return
				null:
					position = position
					return
	elif get_meta(\"metadata\").placing == true:
		$Sprite.z_index = 99
		return

func _area_exited(area):
	if area.has_meta(\"metadata\"):
		if area.get_meta(\"metadata\").type != \"item\" && area.get_meta(\"metadata\").placing == false && get_meta(\"metadata\").placing == false:
			var copy = get_meta(\"metadata\").duplicate(true)
			copy.direction = null
			copy.justplaced = false
			set_meta(\"metadata\",copy.duplicate(true))
"

[sub_resource type="RectangleShape2D" id=1]
extents = Vector2( 32, 32 )

[sub_resource type="GDScript" id=4]
resource_local_to_scene = true
script/source = "extends Area2D

var innercollision = true
"

[sub_resource type="RectangleShape2D" id=3]
extents = Vector2( 30, 30 )

[node name="Area2D" type="Area2D"]
script = SubResource( 2 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( 32, 32 )
z_index = 1
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 32, 32 )
z_index = 1
shape = SubResource( 1 )

[node name="InnerCollision" type="Area2D" parent="."]
script = SubResource( 4 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="InnerCollision"]
position = Vector2( 32, 32 )
shape = SubResource( 3 )

[connection signal="area_exited" from="InnerCollision" to="." method="_area_exited"]
