[gd_scene load_steps=6 format=2]

[ext_resource path="res://textures/items/flushsit.png" type="Texture" id=1]

[sub_resource type="GDScript" id=2]
resource_local_to_scene = true
script/source = "extends Area2D

export(Dictionary) var metadata = {
	\"type\": \"item\",
	\"name\": \"pussyfart\",
	\"desc\": \"pussy shit\",
	\"spritepath\": \"items/flushsit.png\",
	\"direction\": null
}

var innercollision = false

func fix_placing(direction):
	match direction:
		\"down\":
			position.y -= 1
			return
		\"up\":
			position.y += 1
			return
		\"left\":
			position.x += 1
			return
		\"right\":
			position.x -= 1
			return
		null:
			position = position

func _ready():
	get_child(1).texture = get_tree().current_scene.load_texture(\"textures/\" + get_meta(\"metadata\").spritepath)
	get_child(1).scale = Vector2(64/get_child(1).texture.get_size().x, 64/get_child(1).texture.get_size().y)

func _process(_delta):
	var conveyor = false
	var childcheck = get_child(2).get_overlapping_areas().duplicate()
	for area in childcheck:
		if area.is_in_group(\"Conveyor\"):
			childcheck.append(area)
			conveyor = true
			break
	childcheck.erase(self)
	if get_overlapping_areas().empty() || conveyor == false || childcheck.empty():
		var stuff = get_meta(\"metadata\")
		stuff.direction = null
		set_meta(\"metadata\", stuff.duplicate())
		return
	if has_meta(\"metadata\") && conveyor == true:
		match get_meta(\"metadata\").direction:
			\"down\":
				position.y += 1
				return
			\"up\":
				position.y -= 1
				return
			\"left\":
				position.x -= 1
				return
			\"right\":
				position.x += 1
				return
			null:
				position = position
				return

func _area_exited(area):
	if area.has_meta(\"metadata\"):
		if area.get_meta(\"metadata\").type != \"item\":
			var copy = get_meta(\"metadata\")
			copy.direction = null
			set_meta(\"metadata\",copy.duplicate())
"

[sub_resource type="RectangleShape2D" id=1]
extents = Vector2( 32, 32 )

[sub_resource type="GDScript" id=4]
resource_local_to_scene = true
script/source = "extends Area2D

var innercollision = true
"

[sub_resource type="RectangleShape2D" id=3]
extents = Vector2( 30, 30 )

[node name="Area2D" type="Area2D"]
script = SubResource( 2 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 32, 32 )
z_index = 1
shape = SubResource( 1 )

[node name="PlaceholderItem" type="Sprite" parent="."]
position = Vector2( 32, 32 )
z_index = 1
texture = ExtResource( 1 )

[node name="InnerCollision" type="Area2D" parent="."]
script = SubResource( 4 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="InnerCollision"]
position = Vector2( 32, 32 )
shape = SubResource( 3 )

[connection signal="area_exited" from="InnerCollision" to="." method="_area_exited"]
